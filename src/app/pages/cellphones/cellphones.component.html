<app-menu></app-menu>

<section class="page">
  <h1>Pizzas</h1>
  <p>BACKEND de <code>/api/pizzas</code></p>

  <form class="tv-form" [formGroup]="pizzaForm" (ngSubmit)="submitPizza()">
    <div class="fields">
      <label>Nombre <input formControlName="name" /></label>
      <label>Descripción <input formControlName="description" /></label>
      <label>Precio <input type="number" step="0.01" formControlName="price" /></label>

      <label>
        <input type="checkbox" formControlName="vegetarian" />
        Vegetariana
      </label>
      <label>
        <input type="checkbox" formControlName="vegan" />
        Vegana
      </label>
      <label>
        <input type="checkbox" formControlName="available" />
        Disponible
      </label>
    </div>

    <div class="buttons">
      <button type="submit" [disabled]="isSubmitting()">
        {{ editingId() ? 'Actualizar' : 'Agregar' }}
      </button>
      @if (editingId()) {
        <button type="button" (click)="cancelEdit()">Cancelar</button>
      }
    </div>
  </form>

  <div class="toolbar">
    <strong>Listado de pizzas</strong>
    <button type="button" (click)="loadAll()" [disabled]="isLoading()">Todas</button>
    <button type="button" (click)="loadAvailable()" [disabled]="isLoading()">
      Sólo disponibles
    </button>
  </div>

  <div class="toolbar filters">
    <label>
      Buscar por nombre
      <input #nameInput />
      <button type="button" (click)="searchByName(nameInput.value)">Buscar</button>
    </label>

    <label>
      Ingrediente
      <input #ingredientInput />
      <button type="button" (click)="searchWithIngredient(ingredientInput.value)">
        Con
      </button>
      <button type="button" (click)="searchWithoutIngredient(ingredientInput.value)">
        Sin
      </button>
    </label>

    <label>
      Máximo precio
      <input #maxPriceInput type="number" step="0.01" />
      <button type="button" (click)="searchCheapest(maxPriceInput.value)">
        Filtrar
      </button>
    </label>
  </div>

  @if (feedback()) {
    <p class="feedback">{{ feedback() }}</p>
  }

  @if (isLoading()) {
    <p>Cargando...</p>
  } @else if (pizzas().length === 0) {
    <p>No hay pizzas por ahora.</p>
  } @else {
    <ul class="list">
      @for (pizza of pizzas(); track pizza.idPizza) {
        <li>
          <span class="main-info">
            #{{ pizza.idPizza }} - {{ pizza.name }} ({{ pizza.price | number: '1.2-2' }} Bs)
          </span>
          <span class="extra">
            {{ pizza.description }} |
            <strong>
              {{ pizza.vegetarian ? 'Veggie' : 'Clásica' }}
              {{ pizza.vegan ? '/ Vegana' : '' }}
            </strong>
            | Disponible: {{ pizza.available ? 'Sí' : 'No' }}
          </span>
          <div class="item-buttons">
            <button type="button" (click)="editPizza(pizza)">Editar</button>
            <button type="button" (click)="updatePricePrompt(pizza)">
              Actualizar precio
            </button>
            <button
              type="button"
              class="delete"
              (click)="deletePizza(pizza.idPizza!)"
            >
              Eliminar
            </button>
          </div>
        </li>
      }
    </ul>
  }
</section>
